<%- include('../layouts/head.ejs') -%>
    <style>
        /* Custom styles for the coupon card */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out;
        }

        .card:hover {
            transform: scale(1.02);
        }

        .card-body {
            padding: 20px;
            text-align: center;
        }

        .card-title {
            font-size: 2rem;
            color: #28a745;
            margin-bottom: 10px;
        }

        .card-text {
            color: #6c757d;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .card-footer {
            background-color: #f8f9fa;
            border-radius: 0 0 15px 15px;
            padding: 15px;
            text-align: center;
        }

        #copyCouponBtn {
            background-color: #17a2b8;
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background-color 0.3s ease-in-out;
        }

        #copyCouponBtn:hover {
            background-color: #138496;
        }
    </style>


    <body>
        <%- include('../layouts/userNav.ejs') -%>
            <div class="mobile-header-active mobile-header-wrapper-style">
                <div class="mobile-header-wrapper-inner">
                    <div class="mobile-header-top">
                        <div class="mobile-header-logo">
                            <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                        </div>
                        <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                            <button class="close-style search-close">
                                <i class="icon-top"></i>
                                <i class="icon-bottom"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mobile-header-content-area">
                        <div class="mobile-search search-style-3 mobile-header-border">
                            <form action="#">
                                <input type="text" placeholder="Search for items…">
                                <button type="submit"><i class="fi-rs-search"></i></button>
                            </form>
                        </div>
                        <div class="mobile-menu-wrap mobile-header-border">
                            <div class="main-categori-wrap mobile-header-border">
                                <a class="categori-button-active-2" href="#">
                                    <span class="fi-rs-apps"></span> Browse Categories
                                </a>
                                <div class="categori-dropdown-wrap categori-dropdown-active-small">
                                    <ul>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-dress"></i>Women's
                                                Clothing</a></li>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-tshirt"></i>Men's
                                                Clothing</a></li>
                                        <li> <a href="shop-grid-right.html"><i class="evara-font-smartphone"></i>
                                                Cellphones</a></li>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-desktop"></i>Computer &
                                                Office</a></li>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-cpu"></i>Consumer
                                                Electronics</a></li>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-home"></i>Home &
                                                Garden</a></li>
                                        <li><a href="shop-grid-right.html"><i
                                                    class="evara-font-high-heels"></i>Shoes</a></li>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-teddy-bear"></i>Mother &
                                                Kids</a></li>
                                        <li><a href="shop-grid-right.html"><i class="evara-font-kite"></i>Outdoor
                                                fun</a></li>
                                    </ul>
                                </div>
                            </div>
                            <!-- mobile menu start -->
                            <nav>
                                <ul class="mobile-menu">
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                            href="index.html">Home</a>
                                        <ul class="dropdown">
                                            <li><a href="index.html">Home 1</a></li>
                                            <li><a href="index-2.html">Home 2</a></li>
                                            <li><a href="index-3.html">Home 3</a></li>
                                            <li><a href="index-4.html">Home 4</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                            href="shop-grid-right.html">shop</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-grid-right.html">Shop Grid – Right Sidebar</a></li>
                                            <li><a href="shop-grid-left.html">Shop Grid – Left Sidebar</a></li>
                                            <li><a href="shop-list-right.html">Shop List – Right Sidebar</a></li>
                                            <li><a href="shop-list-left.html">Shop List – Left Sidebar</a></li>
                                            <li><a href="shop-fullwidth.html">Shop - Wide</a></li>
                                            <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                                    href="#">Single Product</a>
                                                <ul class="dropdown">
                                                    <li><a href="shop-product-right.html">Product – Right Sidebar</a>
                                                    </li>
                                                    <li><a href="shop-product-left.html">Product – Left Sidebar</a></li>
                                                    <li><a href="shop-product-full.html">Product – No sidebar</a></li>
                                                </ul>
                                            </li>
                                            <li><a href="shop-filter.html">Shop – Filter</a></li>
                                            <li><a href="shop-wishlist.html">Shop – Wishlist</a></li>
                                            <li><a href="shop-cart.html">Shop – Cart</a></li>
                                            <li><a href="shop-checkout.html">Shop – Checkout</a></li>
                                            <li><a href="shop-compare.html">Shop – Compare</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Mega
                                            menu</a>
                                        <ul class="dropdown">
                                            <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                                    href="#">Women's Fashion</a>
                                                <ul class="dropdown">
                                                    <li><a href="shop-product-right.html">Dresses</a></li>
                                                    <li><a href="shop-product-right.html">Blouses & Shirts</a></li>
                                                    <li><a href="shop-product-right.html">Hoodies & Sweatshirts</a></li>
                                                    <li><a href="shop-product-right.html">Women's Sets</a></li>
                                                </ul>
                                            </li>
                                            <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                                    href="#">Men's Fashion</a>
                                                <ul class="dropdown">
                                                    <li><a href="shop-product-right.html">Jackets</a></li>
                                                    <li><a href="shop-product-right.html">Casual Faux Leather</a></li>
                                                    <li><a href="shop-product-right.html">Genuine Leather</a></li>
                                                </ul>
                                            </li>
                                            <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                                    href="#">Technology</a>
                                                <ul class="dropdown">
                                                    <li><a href="shop-product-right.html">Gaming Laptops</a></li>
                                                    <li><a href="shop-product-right.html">Ultraslim Laptops</a></li>
                                                    <li><a href="shop-product-right.html">Tablets</a></li>
                                                    <li><a href="shop-product-right.html">Laptop Accessories</a></li>
                                                    <li><a href="shop-product-right.html">Tablet Accessories</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                            href="blog-category-fullwidth.html">Blog</a>
                                        <ul class="dropdown">
                                            <li><a href="blog-category-grid.html">Blog Category Grid</a></li>
                                            <li><a href="blog-category-list.html">Blog Category List</a></li>
                                            <li><a href="blog-category-big.html">Blog Category Big</a></li>
                                            <li><a href="blog-category-fullwidth.html">Blog Category Wide</a></li>
                                            <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                                    href="#">Single Product Layout</a>
                                                <ul class="dropdown">
                                                    <li><a href="blog-post-left.html">Left Sidebar</a></li>
                                                    <li><a href="blog-post-right.html">Right Sidebar</a></li>
                                                    <li><a href="blog-post-fullwidth.html">No Sidebar</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                            href="#">Pages</a>
                                        <ul class="dropdown">
                                            <li><a href="page-about.html">About Us</a></li>
                                            <li><a href="page-contact.html">Contact</a></li>
                                            <li><a href="page-account.html">My Account</a></li>
                                            <li><a href="page-login-register.html">login/register</a></li>
                                            <li><a href="page-purchase-guide.html">Purchase Guide</a></li>
                                            <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                                            <li><a href="page-terms.html">Terms of Service</a></li>
                                            <li><a href="page-404.html">404 Page</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a
                                            href="#">Language</a>
                                        <ul class="dropdown">
                                            <li><a href="#">English</a></li>
                                            <li><a href="#">French</a></li>
                                            <li><a href="#">German</a></li>
                                            <li><a href="#">Spanish</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </nav>
                            <!-- mobile menu end -->
                        </div>
                        <div class="mobile-header-info-wrap mobile-header-border">
                            <div class="single-mobile-header-info mt-30">
                                <a href="page-contact.html"> Our location </a>
                            </div>
                            <div class="single-mobile-header-info">
                                <a href="page-login-register.html">Log In / Sign Up </a>
                            </div>
                            <div class="single-mobile-header-info">
                                <a href="#">(+01) - 2345 - 6789 </a>
                            </div>
                        </div>
                        <div class="mobile-social-icon">
                            <h5 class="mb-15 text-grey-4">Follow Us</h5>
                            <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                            <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                            <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                            <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                            <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                        </div>
                    </div>
                </div>
            </div>
            <main class="main">
                <div class="page-header breadcrumb-wrap">
                    <div class="container">
                        <div class="breadcrumb">
                            <a href="index.html" rel="nofollow">Home</a>
                            <span></span> Shop
                            <span></span> Checkout
                        </div>
                    </div>
                </div>
                <section class="mt-50 mb-50">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="order_review">
                                    <div class="mb-20">
                                        <h4>Your Orders</h4>
                                    </div>
                                    <div class="table-responsive order_table text-center">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th colspan="2">Product</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% let totalSubTotal=0 %>
                                                    <% for (let i=0; i < cart.length; i++) { %>
                                                        <tr>
                                                            <td colspan="2">
                                                                <h5><a href="shop-product-full.html">
                                                                        <%= cart[i].productName %>
                                                                    </a></h5>
                                                                <span class="product-qty">x <%= cart[i].quantity %>
                                                                </span>
                                                            </td>
                                                            <% if (product && product.length && cart && cart.length &&
                                                                product[i]) { %>
                                                                <% let productSubTotal=product[i].salePrice *
                                                                    cart[i].quantity %>
                                                                    <td>$<%= productSubTotal %>
                                                                    </td>
                                                                    <% totalSubTotal +=productSubTotal %>
                                                                        <% } %>
                                                        </tr>
                                                        <% } %>
                                                            <tr>
                                                                <th>SubTotal</th>
                                                                <td class="product-subtotal" id="subtotal" colspan="2">$
                                                                    <%= totalSubTotal.toFixed(2) %>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <th>Shipping</th>
                                                                <td colspan="2"><em>Free Shipping</em></td>
                                                            </tr>
                                                            <tr>
                                                                <th>Total</th>
                                                                <td colspan="2"
                                                                    class="product-subtotal font-xl text-brand fw-900"
                                                                    id="total">$<%= totalSubTotal.toFixed(2) %>
                                                                </td>
                                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <p id="couponDiscount"><span>Coupon Discount:</span> <span
                                            id="couponDiscountAmount"></span></p>
                                    <div class="form-group">
                                        <label for="couponCode">Coupon Code:</label>
                                        <div class="input-group-append">
                                            <input type="text" id="couponCode" style="width: 190px; height: 45px;"
                                                name="couponCode" placeholder="Coupon code">
                                            <span>
                                                <a class="btn btn-warning" onclick="applyCoupon()">Apply</a>
                                            </span>
                                            <span>
                                                <button id="showCouponModalBtn" class="btn btn-success btn-sm ml-3"
                                                    data-bs-toggle="modal" data-bs-target="#couponModal">Show Available
                                                    Coupons</button>
                                            </span>
                                        </div>
                                        <p id="couponMessage" class="text-danger"></p>
                                        <a id="removeCoupon" href="#" onclick="removeCoupon()"
                                            style="display: none;">Remove Coupon</a>
                                    </div>

                                </div>
                                <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                <div class="payment_method">
                                    <div class="mb-25">
                                        <h5>Payment</h5>
                                    </div>
                                    <div class="payment_option">
                                        <div class="custome-radio">
                                            <input class="form-check-input payment" required="" value="cod" type="radio"
                                                name="payment_option" id="exampleRadios3" checked>
                                            <label class="form-check-label" for="exampleRadios3"
                                                data-bs-toggle="collapse" data-target="#cashOnDelivery"
                                                aria-controls="cashOnDelivery">Cash on Delivery</label>
                                            <div class="form-group collapse in" id="cashOnDelivery">
                                                <p class="text-muted mt-5">There are many variations of passages of
                                                    Lorem Ipsum available, but the majority have suffered alteration.
                                                </p>
                                            </div>
                                        </div>

                                        <div class="custome-radio">
                                            <input class="form-check-input payment" required="" type="radio"
                                                value="razorPay" name="payment_option" id="exampleRadios5">
                                            <label class="form-check-label" for="exampleRadios5"
                                                data-bs-toggle="collapse" data-target="#razorPay"
                                                aria-controls="razorPay">Razor Pay</label>
                                            <div class="form-group collapse in" id="razorPay">
                                                <p class="text-muted mt-5">Pay via PayPal; you can pay with your credit
                                                    card if you don't have a PayPal account.</p>
                                            </div>
                                        </div>

                                        <div class="custome-radio">
                                            <input class="form-check-input payment" required="" type="radio"
                                                value="wallet" name="payment_option" id="exampleRadios6">
                                            <label class="form-check-label" for="exampleRadios6"
                                                data-bs-toggle="collapse" data-target="#wallet"
                                                aria-controls="wallet">Wallet</label>
                                            <div class="form-group collapse in" id="wallet">
                                                <p class="text-muted mt-5">Pay via wallet; you can pay with wallet.</p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <button id="submitButton" class="btn btn-fill-out btn-block mt-30"
                                    onclick="placeOrder('<%= cart._id %>')">Place Order</button>
                            </div>
                            <div class="col-md-6">

                                <div class="row">
                                    <!-- New shipping address box goes here -->
                                    <% if (address && address.length) { %>
                                        <% for (let i=0; i < address.length; i++) { %>
                                            <div class="col-md-12">
                                                <div class="form-check">
                                                    <input class="form-check-input address" type="radio"
                                                        name="flexRadioDefault" id="" value="<%= address[i]._id %>"
                                                        checked>
                                                    <label class="form-check-label" for="flexRadioDefault1">
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h5 class="mb-0">Shipping Address</h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <address>
                                                                    <%= address[i].fullName %><br>
                                                                        <%= address[i].mobile %><br>
                                                                            <%= address[i].pincode %><br>
                                                                                <%= address[i].addressLine %>
                                                                </address>
                                                                <p></p>
                                                            </div>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>
                                            <% } %>
                                                <% } else { %>
                                                    <p>No addresses found.</p>
                                                    <% } %>
                                                        <!-- End of new shipping address box -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>




            </main>
            <footer class="main">
                <section class="newsletter p-30 text-white wow fadeIn animated">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-7 mb-md-3 mb-lg-0">
                                <div class="row align-items-center">
                                    <div class="col flex-horizontal-center">
                                        <img class="icon-email" src="assets/imgs/theme/icons/icon-email.svg" alt="">
                                        <h4 class="font-size-20 mb-0 ml-3">Sign up to Newsletter</h4>
                                    </div>
                                    <div class="col my-4 my-md-0 des">
                                        <h5 class="font-size-15 ml-4 mb-0">...and receive <strong>$25 coupon for first
                                                shopping.</strong></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <!-- Subscribe Form -->
                                <form class="form-subcriber d-flex wow fadeIn animated">
                                    <input type="email" class="form-control bg-white font-small"
                                        placeholder="Enter your email">
                                    <button class="btn bg-dark text-white" type="submit">Subscribe</button>
                                </form>
                                <!-- End Subscribe Form -->
                            </div>
                        </div>
                    </div>
                </section>
                <section class="section-padding footer-mid">
                    <div class="container pt-15 pb-20">
                        <div class="row">
                            <div class="col-lg-4 col-md-6">
                                <div class="widget-about font-md mb-md-5 mb-lg-0">
                                    <div class="logo logo-width-1 wow fadeIn animated">
                                        <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                                    </div>
                                    <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                                    <p class="wow fadeIn animated">
                                        <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                                    </p>
                                    <p class="wow fadeIn animated">
                                        <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                                    </p>
                                    <p class="wow fadeIn animated">
                                        <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                                    </p>
                                    <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                                    <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                                        <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                                        <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                        <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                                        <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                                        <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-3">
                                <h5 class="widget-title wow fadeIn animated">About</h5>
                                <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                                    <li><a href="#">About Us</a></li>
                                    <li><a href="#">Delivery Information</a></li>
                                    <li><a href="#">Privacy Policy</a></li>
                                    <li><a href="#">Terms &amp; Conditions</a></li>
                                    <li><a href="#">Contact Us</a></li>
                                    <li><a href="#">Support Center</a></li>
                                </ul>
                            </div>
                            <div class="col-lg-2  col-md-3">
                                <h5 class="widget-title wow fadeIn animated">My Account</h5>
                                <ul class="footer-list wow fadeIn animated">
                                    <li><a href="#">Sign In</a></li>
                                    <li><a href="#">View Cart</a></li>
                                    <li><a href="#">My Wishlist</a></li>
                                    <li><a href="#">Track My Order</a></li>
                                    <li><a href="#">Help</a></li>
                                    <li><a href="#">Order</a></li>
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <h5 class="widget-title wow fadeIn animated">Install App</h5>
                                <div class="row">
                                    <div class="col-md-8 col-lg-12">
                                        <p class="wow fadeIn animated">From App Store or Google Play</p>
                                        <div class="download-app wow fadeIn animated">
                                            <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active"
                                                    src="assets/imgs/theme/app-store.jpg" alt=""></a>
                                            <a href="#" class="hover-up"><img src="assets/imgs/theme/google-play.jpg"
                                                    alt=""></a>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                                        <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                                        <img class="wow fadeIn animated" src="assets/imgs/theme/payment-method.png"
                                            alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <div class="container pb-20 wow fadeIn animated">
                    <div class="row">
                        <div class="col-12 mb-20">
                            <div class="footer-bottom"></div>
                        </div>
                        <div class="col-lg-6">
                            <p class="float-md-left font-sm text-muted mb-0">&copy; 2022, <strong
                                    class="text-brand">Evara</strong> - HTML Ecommerce Template </p>
                        </div>
                        <div class="col-lg-6">
                            <p class="text-lg-end text-start font-sm text-muted mb-0">
                                Designed by <a href="http://alithemes.com/" target="_blank">Alithemes.com</a>. All
                                rights reserved
                            </p>
                        </div>
                    </div>
                </div>
            </footer>
            <!-- Preloader Start -->



            <!-- copon model -->


            <section class="coupon-section mt-30">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-20">
                                <h4>Available Coupons</h4>
                            </div>
                            <!-- Button to show the coupon modal -->
                            <button id="showCouponModalBtn" class="btn btn-info" data-bs-toggle="modal"
                                data-bs-target="#couponModal">Show Available Coupons</button>

                            <!-- Coupon Modal -->
                            <div class="modal fade" id="couponModal" tabindex="-1" aria-labelledby="couponModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="couponModalLabel">Exclusive Offer</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <% for (let i=0; i < coupon.length; i++) { %>

                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">Awesome Deal</h5>
                                                        <p class="card-text">COUPON NAME:<%= coupon[i].name %>
                                                        </p>
                                                        <p class="card-text">Expires on:<%=
                                                                coupon[i].expiryDate.toLocaleDateString() %>
                                                        </p>
                                                        <p class="card-text">Use code: <%= coupon[i].code %>
                                                        </p>
                                                        <p class="card-text">Offer:<%= coupon[i].percentageDiscount %>%
                                                        </p>
                                                    </div>
                                                    <div class="card-footer">
                                                        <button class="btn btn-success copyCouponBtn"
                                                            data-coupon-code="<%= coupon[i].code %>">Copy Coupon
                                                            Code</button>
                                                        <!-- Input field for copying the code -->
                                                        <input type="text" class="copyInput"
                                                            value="<%= coupon[i].code %>"
                                                            style="position: absolute; left: -9999px;">
                                                    </div>
                                                </div>
                                                <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Include your JavaScript at the end of the body -->
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    // Use proper selector for all the copy buttons
                    let copybtns = document.querySelectorAll(".copyCouponBtn");

                    // Loop through each copy button and attach the click event
                    copybtns.forEach(copybtn => {
                        copybtn.addEventListener('click', copyIt);
                    });
                });

                function copyIt(event) {

                    // Get the clicked button
                    let copybtn = event.target;

                    // Get the associated input element with the class 'copyInput'
                    let copyInput = copybtn.parentElement.querySelector('.copyInput');

                    // Select the coupon code
                    copyInput.select();

                    // Copy the selected text
                    document.execCommand("copy");

                    // Change the button text to "COPIED"
                    copybtn.textContent = "COPIED";
                }
            </script>





            <script>
                function applyCoupon() {
                    const couponCode = document.getElementById("couponCode").value;


                    const couponMessage = document.getElementById("couponMessage");
                    const subtotalElement = document.getElementById("subtotal");
                    const couponDiscountElement = document.getElementById("couponDiscountAmount");
                    const totalElement = document.getElementById("total");  // Ensure this element is defined
                    const removeCouponLink = document.getElementById("removeCoupon");  // Ensure this element is defined

                    fetch("/addcouponcode", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ couponCode, subtotal: subtotalElement.innerText }),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.success) {
                                couponMessage.innerText = data.message;
                                ;

                                const subtotal = extractNumericValue(subtotalElement.innerText);


                                const discountAmount = parseFloat(
                                    String(data.discountAmount).replace("₹", "").replace(/,/g, "")
                                );


                                if (!isNaN(subtotal) && !isNaN(discountAmount)) {
                                    const discountedSubtotal = subtotal - discountAmount;

                                    // Update the UI
                                    couponDiscountElement.innerText = `₹ ${discountAmount.toLocaleString()}`;
                                    couponDiscountElement.parentNode.style.display = "block";
                                    totalElement.innerHTML = `<span class="font-xl text-brand fw-900">₹${discountedSubtotal.toLocaleString()}</span>`;
                                    removeCouponLink.style.display = "block";
                                } else {
                                    couponMessage.innerText = "Error: Invalid subtotal or discount amount.";
                                }
                            } else {
                                couponMessage.innerText = data.message;
                                couponDiscountElement.parentNode.style.display = "none"; // Hide the coupon discount li
                            }
                        })
                        .catch((error) => {

                        });
                }


                // function extractNumericValue(str) {
                //   const numericString = str.replace(/[^0-9.-]+/g, "");
                //   return parseFloat(numericString);
                // }


                function removeCoupon() {
                    const couponCode = document.getElementById("couponCode").value;
                    const totalElement = document.getElementById("total");

                    fetch("/remove-coupon", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ couponCode }),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            const couponMessage = document.getElementById("couponMessage");
                            const couponDiscountElement = document.getElementById("couponDiscountAmount");
                            const removeCouponLink = document.getElementById("removeCoupon");

                            if (data.success) {
                                // Update UI to indicate successful coupon removal
                                const total = extractNumericValue(totalElement.innerText);
                                const discountAmount = data.discountAmount;

                                if (!isNaN(total) && !isNaN(discountAmount)) {

                                    const discountedSubtotal = total + discountAmount;
                                    ;

                                    couponMessage.innerText = "";
                                    couponDiscountElement.parentNode.style.display = "none";
                                    totalElement.innerHTML = `<span class="font-xl text-brand fw-900">₹ ${discountedSubtotal.toLocaleString()}</span>`;
                                    removeCouponLink.style.display = "none";

                                    document.getElementById("couponCode").value = "";
                                } else {
                                    couponMessage.innerText = "Error: Invalid total or discount amount.";
                                }
                            } else {
                                couponMessage.innerText = data.message || "Error: Unable to remove coupon.";
                            }
                        })
                        .catch((error) => {

                        });
                }

                function extractNumericValue(str) {
                    const numericString = str.replace(/[^0-9.-]+/g, "");
                    return parseFloat(numericString);
                }



            </script>







            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
            <script>
                async function placeOrder(cartId) {

                    var address = $('.address:checked').val();
                    var payment = $('.payment:checked').val();

                    // Check if no payment option is selected
                    const displayedSum = document.getElementById('subtotal').textContent;
                    const numericValue = parseFloat(displayedSum.replace(/[^\d.]/g, ''));


                    if (!payment) {
                        Swal.fire({
                            title: 'NO PAYMENT FOUND!',
                            text: 'Please select your payment method.',
                            icon: 'error',
                            timer: 3000,
                        });
                    }

                    // Check if no address is selected
                    if (!address) {
                        Swal.fire({
                            title: 'NO ADDRESS FOUND!',
                            text: 'Please select your address.',
                            icon: 'error',
                            timer: 3000,
                        });
                    } else {
                        // AJAX request in the else case
                        const totalElement = document.getElementById("total");
                        const total = parseFloat(totalElement.innerText.replace(/[^0-9.-]+/g, ''));

                        $.ajax({
                            url: "/orderPlaced",
                            type: "post",
                            contentType: "application/json",
                            data: JSON.stringify({
                                addressId: address,
                                payment: payment,
                                totalAmount: total,


                                // totalPrice:totalSubTotal.toFixed(2) ,
                            }),
                            async: true,
                            success: function (response) {



                                // If you want to reload the page after successful order placement

                                if (response && response.method && response.method.toLowerCase() === "cod") {


                                    verifyPayment(response);
                                }

                                else if (response.method == 'online') {


                                    var razorpayApiKey = 'rzp_test_O3ookB75C6tQTa';
                                    var orderAmount = numericValue;


                                    var options = {
                                        "key": razorpayApiKey,
                                        "amount": orderAmount, // Dynamically calculated amount
                                        "currency": "INR",
                                        "name": "flock",
                                        "description": "Order Payment",
                                        "order_id": response.razorpayOrder.id, // Replace with actual order ID
                                        "handler": function (response) {

                                            verifyPayment(response);

                                        },
                                        "prefill": {
                                            "name": "Customer Name", // Set to the customer's name
                                            "email": "customer@example.com", // Set to the customer's email
                                            "contact": "9000090000" // Set to the customer's contact number
                                        },
                                        "callback_url": "/your-server-callback-url", // Replace with your server's callback URL
                                        "theme": {
                                            "color": "#3399cc"
                                        }
                                    };
                                    var rzp1 = new Razorpay(options);
                                    rzp1.open();


                                } else if (response.method == 'wallet') {

                                    verifyPayment(response);

                                }

                            },
                            error: function (xhr, status, error) {
                                console.error("Failed to place the order", error);
                                Swal.fire({
                                    title: 'Insufficient Wallet Balance',
                                    text: 'Your wallet balance is not sufficient for this order.',
                                    icon: 'error',
                                    timer: 3000,
                                });
                            },
                        });

                        function verifyPayment(response) {


                            window.location.href = "/order"


                        }


                    }


                }
            </script>

            <!-- Vendor JS-->
            <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
            <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
            <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
            <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
            <script src="assets/js/plugins/slick.js"></script>
            <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
            <script src="assets/js/plugins/wow.js"></script>
            <script src="assets/js/plugins/jquery-ui.js"></script>
            <script src="assets/js/plugins/perfect-scrollbar.js"></script>
            <script src="assets/js/plugins/magnific-popup.js"></script>
            <script src="assets/js/plugins/select2.min.js"></script>
            <script src="assets/js/plugins/waypoints.js"></script>
            <script src="assets/js/plugins/counterup.js"></script>
            <script src="assets/js/plugins/jquery.countdown.min.js"></script>
            <script src="assets/js/plugins/images-loaded.js"></script>
            <script src="assets/js/plugins/isotope.js"></script>
            <script src="assets/js/plugins/scrollup.js"></script>
            <script src="assets/js/plugins/jquery.vticker-min.js"></script>
            <!-- Template  JS -->
            <script src="assets/js/maind134.js?v=3.4"></script>
            <script src="assets/js/shopd134.js?v=3.4"></script>

            <%- include("../layouts/footer.ejs") -%>